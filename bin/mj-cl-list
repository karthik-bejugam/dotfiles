#!/usr/bin/env bash

#
# Ask ec2 for the nodes in a cluster. Caches the info for
# later use. Note that since grep is used a regular expression also works.
# Therefor, use with caution.
#
cl=$1
if [ "$cl" == "" ] ; then echo -e "Usage: $0 cluster\n\n\texample: $0 gibbon\n" ; exit ; fi

mjuserdir=/tmp/mj-${USER}
mjclinfo=${mjuserdir}/${cl}-info.log
mjhosts=${mjuserdir}/${cl}-hosts.log

source "$HOME/.hadoop-ec2/aws_private_setup.sh"
mkdir -p ${mjuserdir}
ec2-describe-instances | grep ${cl} | grep -i "^instance" > ${mjclinfo}
cat ${mjclinfo}
cat ${mjclinfo} | cut -f4 > ${mjhosts}
