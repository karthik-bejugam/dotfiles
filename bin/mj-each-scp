#!/usr/bin/env bash

#
# Copies "localfile" to every "remotefile" on every machine in cluster "cl"
#
cl=${1}         ; shift
localfile=${1}  ; shift
remotefile=${1} ; shift

if [ "$cl" == "" ] ; then echo -e "\nUsage: $0 clustername localfile remotefile\n\n\texample: $0 gibbon foo.txt /tmp/foo.txt\n" ; exit ; fi

mjuserdir=/tmp/mj-${USER}
mjhosts=${mjuserdir}/${cl}-hosts.log

if [ ! -e "$mjhosts" ] ; then echo "Please run mj-cl-list to generate hosts first." ; exit ; fi

# iterate through list of nodes
echo "distributing ${localfile} to ${cl}..."
for host in `cat ${mjhosts}`; do
    `mj-scp ${cl} ${host} ${localfile} ${remotefile}`
done
